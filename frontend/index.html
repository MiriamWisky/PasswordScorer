<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>砖 拽 住住</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container { 
            max-width: 700px; 
            margin: 0 auto; 
            padding: 30px; 
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        input[type="text"] { 
            padding: 15px; 
            width: 100%; 
            margin-bottom: 20px; 
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        button { 
            padding: 12px 20px; 
            font-size: 14px; 
            cursor: pointer; 
            border: none; 
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }
        
        #results { 
            margin-top: 30px; 
            padding: 20px; 
            border-radius: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            text-align: right; 
        }
        .weak { color: #dc3545; font-weight: bold; }
        .medium { color: #fd7e14; font-weight: bold; }
        .strong { color: #28a745; font-weight: bold; }
        
        #historyResults {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        #historyList {
            list-style: none;
            padding: 0;
        }
        #historyList li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">

        
       
        <h2>砖 拽 住住  驻爪 </h2>
        <input type="text" id="passwordInput" placeholder="住 住住 ..." onkeyup="if(this.value.length > 0) checkPassword(false)"> 

        <div class="button-group">
            <button class="btn-primary" onclick="checkPassword(true)">拽 砖专</button>
            <button class="btn-warning" onclick="generatePassword()">专爪 住住 拽</button>
            <button class="btn-success" onclick="showHistory()">爪 住专</button>
            <button class="btn-info" onclick="logout()">转转拽转</button>
        </div>

        <div id="results">
            <strong>转爪转 拽:</strong>
            <p id="scoreLevel">专转 拽: <span class="weak">...</span></p>
            <p id="crackingTime"> 驻爪 : <span>...</span></p>
            <p id="statusMessage">转爪转 砖专 住住 转 (PostgreSQL).</p>
        </div>

        <div id="historyResults" style="display: none;">
            <h4>住专转 10 住住转 专转:</h4>
            <ul id="historyList"></ul>
        </div>
        
    </div>

    <script>
        // 拽转 转专转 注转 注
        window.addEventListener('load', function() {
            checkAuthStatus();
        });
        
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/v1/history', {
                    method: 'GET'
                });
                
                if (response.status === 401) {
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.log('Auth check failed');
            }
        }
        
        async function logout() {
            try {
                await fetch('/api/v1/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }
        
        // 驻拽爪 转 驻转 砖 爪: 拽 转 (false)  砖专 (true)
    async function checkPassword(saveToDb) {
        const password = document.getElementById('passwordInput').value;
        const scoreLevelElement = document.getElementById('scoreLevel');
        const crackingTimeElement = document.getElementById('crackingTime');
        const statusMessageElement = document.getElementById('statusMessage');

        if (password.length === 0) {
            scoreLevelElement.innerHTML = '专转 拽: <span class="weak">...</span>';
            crackingTimeElement.innerHTML = ' 驻爪 : <span>...</span>';
            statusMessageElement.textContent = '';
            return;
        }
        
        //  转 祝 拽砖,   save_to_db
        const payload = { 
            password: password, 
            save_to_db: saveToDb // True  False
        };
        
        try {
            // 砖 拽砖 转 专砖
            const response = await fetch('/api/v1/score', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload) 
            });

            const data = await response.json();
            
            if (data.error) {
                scoreLevelElement.innerHTML = '专转 拽: <span class="weak">砖</span>';
                crackingTimeElement.innerHTML = ' 驻爪 : <span> </span>';
                statusMessageElement.textContent = `砖: ${data.error}`;
                return;
            }
            
            // 注 -UI 注 拽  驻爪
            let strengthClass = 'weak';
            let strengthText = ' 注';
            
            if (data.strength === 0) {
                strengthClass = 'weak';
                strengthText = '砖';
            } else if (data.strength === 1) {
                strengthClass = 'medium';
                strengthText = '转';
            } else if (data.strength === 2) {
                strengthClass = 'strong';
                strengthText = '拽';
            }
            
            scoreLevelElement.innerHTML = `专转 拽: <span class="${strengthClass}">${strengthText}</span>`;
            crackingTimeElement.innerHTML = ` 驻爪 : <span>${data.crack_time}</span>`;
            
            if (saveToDb) {
                statusMessageElement.textContent = `住住 砖专 住住 转 (拽: ${strengthText}).`;
            } else {
                statusMessageElement.textContent = '拽  -  砖专 住住 转.';
            }
            
            // 拽 拽住 拽住 专 砖专
            if (data.clear_input) {
                document.getElementById('passwordInput').value = '';
            }
            
        } catch (error) {
            scoreLevelElement.innerHTML = '专转 拽: <span class="weak">砖</span>';
            crackingTimeElement.innerHTML = ' 驻爪 : <span> </span>';
            statusMessageElement.textContent = '砖:  转 拽 拽 住住.';
            console.error('Check Error:', error);
        }
    }

        // 驻拽爪 专爪 砖 住住 爪转
    async function generatePassword() {
        const passwordInput = document.getElementById('passwordInput');
        const scoreLevelElement = document.getElementById('scoreLevel');
        const crackingTimeElement = document.getElementById('crackingTime');
        const statusMessageElement = document.getElementById('statusMessage');
        
        statusMessageElement.textContent = '专 住住 爪转...';
        
        try {
            const response = await fetch('/api/v1/recommend', { method: 'GET' });
            const data = await response.json();
            
            if (data.error) {
                statusMessageElement.textContent = `砖: ${data.error}`;
                return;
            }
            
            // 住转 住住 砖 拽住
            passwordInput.value = data.password;
            
            // 注 转爪转
            let strengthClass = 'weak';
            let strengthText = ' 注';
            
            if (data.strength === 0) {
                strengthClass = 'weak';
                strengthText = '砖';
            } else if (data.strength === 1) {
                strengthClass = 'medium';
                strengthText = '转';
            } else if (data.strength === 2) {
                strengthClass = 'strong';
                strengthText = '拽';
            }
            
            scoreLevelElement.innerHTML = `专转 拽: <span class="${strengthClass}">${strengthText}</span>`;
            crackingTimeElement.innerHTML = ` 驻爪 : <span>${data.crack_time}</span>`;
            // 拽  住住 住住转 注 驻住 拽
            const isBasedOnHistory = data.password.includes('miriam') || data.password.includes('miri');
            if (isBasedOnHistory) {
                statusMessageElement.textContent = '住住 拽 爪专 爪! (住住 注 住住转 砖)';
            } else {
                statusMessageElement.textContent = '住住 拽 爪专 爪!';
            }
            
        } catch (error) {
            statusMessageElement.textContent = '砖:  转 专专 住住 爪转.';
            console.error('Generate Password Error:', error);
        }
    }

        // 驻拽爪 砖 爪转 住专
    async function showHistory() {
        const historyList = document.getElementById('historyList');
        const historyResultsDiv = document.getElementById('historyResults');
        historyList.innerHTML = '注...';
        historyResultsDiv.style.display = 'block';

        try {
            // 砖 拽砖转 GET -Endpoint 砖
            const response = await fetch('/api/v1/history', { method: 'GET' });
            const data = await response.json();

            historyList.innerHTML = ''; // 拽 转 专砖转 注

            if (response.ok && Array.isArray(data)) {
                if (data.length === 0) {
                    historyList.innerHTML = '<li> 爪 拽转 拽转.</li>';
                } else {
                    data.forEach(item => {
                        const li = document.createElement('li');
                        // 砖 -Hash -Password
                        li.textContent = `拽: ${item.strength_level} | 住住: ${item.password} | : ${new Date(item.timestamp).toLocaleString()}`;
                        historyList.appendChild(li);
                    });
                }
            } else {
                historyList.innerHTML = `<li>砖 砖驻转 转: ${data.error || ' 注'}</li>`;
            }
        } catch (error) {
            historyList.innerHTML = `<li>砖转 专砖转:  转 转专 砖专转.</li>`;
            console.error('History Fetch Error:', error);
        }
    }
    </script>
</body>
</html>